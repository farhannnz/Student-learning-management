<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Teacher Dashboard</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <div class="auth-card">
            <h2>Teacher Dashboard Test</h2>
            <div id="status">Loading...</div>
            <div id="debug-info" style="margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 8px; font-family: monospace; font-size: 12px; max-height: 400px; overflow-y: auto;"></div>
        </div>
    </div>

    <!-- Supabase JS -->
    <script src="js/supabase-local.js"></script>
    <script src="js/supabaseClient.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const status = document.getElementById('status');
            const debugInfo = document.getElementById('debug-info');
            
            function log(message) {
                console.log(message);
                debugInfo.innerHTML += message + '<br>';
            }
            
            try {
                log('‚úÖ Starting tests...');
                
                // Test 1: Supabase client
                if (typeof supabase !== 'undefined') {
                    log('‚úÖ Supabase client loaded');
                } else {
                    log('‚ùå Supabase client not loaded');
                    return;
                }
                
                // Test 2: Database connection
                log('üîç Testing database connection...');
                const { data, error } = await supabase
                    .from('profiles')
                    .select('count(*)')
                    .limit(1);
                
                if (error) {
                    log('‚ùå Database error: ' + error.message);
                } else {
                    log('‚úÖ Database connection successful');
                }
                
                // Test 3: Check tables
                log('üîç Checking tables...');
                const tables = ['profiles', 'materials', 'assignments', 'quiz_sets'];
                
                for (const table of tables) {
                    try {
                        const { data, error } = await supabase
                            .from(table)
                            .select('id')
                            .limit(1);
                        
                        if (error) {
                            log(`‚ùå Table ${table}: ${error.message}`);
                        } else {
                            log(`‚úÖ Table ${table}: OK`);
                        }
                    } catch (e) {
                        log(`‚ùå Table ${table}: ${e.message}`);
                    }
                }
                
                // Test 4: Authentication
                log('üîç Testing authentication...');
                const { data: { user }, error: authError } = await supabase.auth.getUser();
                
                if (authError) {
                    log('‚ùå Auth error: ' + authError.message);
                } else if (user) {
                    log('‚úÖ User logged in: ' + user.email);
                    
                    // Get profile
                    const { data: profile, error: profileError } = await supabase
                        .from('profiles')
                        .select('*')
                        .eq('id', user.id)
                        .single();
                    
                    if (profileError) {
                        log('‚ùå Profile error: ' + profileError.message);
                    } else {
                        log('‚úÖ Profile loaded: ' + profile.full_name + ' (' + profile.role + ')');
                        if (profile.roll_number) {
                            log('‚úÖ Roll number: ' + profile.roll_number);
                        }
                    }
                } else {
                    log('‚ö†Ô∏è No user logged in');
                }
                
                status.innerHTML = '‚úÖ Tests completed! Check debug info below.';
                status.style.color = 'green';
                
            } catch (error) {
                log('‚ùå Test failed: ' + error.message);
                status.innerHTML = '‚ùå Tests failed! Check debug info below.';
                status.style.color = 'red';
            }
        });
    </script>
</body>
</html>